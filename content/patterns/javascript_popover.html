---
title: "Vanilla JS Popover Microinteraction"
date: 2020-12-07T20:26:54-06:00
draft: false
summary: "A popover is a transient view that shows on a content screen when a user clicks on a control button or within a defined area."
slug: javascript
categories:
- Design System
- UI Components
- Microinteraction
tags:
- UX
- JavaScript
---
<output>
{{< highlight JavaScript >}}
//  A popover is a transient view that shows on a content screen when
//  a user clicks on a control button or within a defined area.
/***
 *     _     _ _____    _     _ _    _ 
 *    | |   | (_____)  | |   | \ \  / /
 *    | |   | |  _     | |   | |\ \/ / 
 *    | |   | | | |    | |   | | )  (  
 *    | |___| |_| |_   | |___| |/ /\ \ 
 *     \______(_____)   \______/_/  \_\ */

let oPopOver = ( ( _win, _doc, _qry ) => {
        let arPops = [], ePos, iOffTop=0, iOffLft=0;
        return {  // Popover UX pattern
            "init": function(){ // wire DOM events
                arPops= [].slice.call(_doc.querySelectorAll( _qry ));
                _win.addEventListener("resize", oPopOver.closeAll);
                _win.addEventListener("scroll", oPopOver.closeAll); 
                _doc.body.addEventListener("click", function( e ){ // Outside Click
                    let eTarget = e.target, bInside = false;
                    while( eTarget.tagName !== "HTML" ){
                        if( eTarget.dataset.popover ){ bInside = true; break; }
                        eTarget = eTarget.parentNode;
                    }
                    if( !bInside ){ // Tapped Outside of Popup
                        oPopOver.closeAll();
                    }
                }, true);
            },
            "open": function(id, evPos){ // Open a single Popover
                if( arPops.length == 0) return false;
                oPopOver.closeAll();
                ePos = evPos.currentTarget;
                let elPop = arPops.filter(function(el){
                    return ( el.id == id );
                })[0];
                iOffTop = Number(elPop.dataset.popoverPos.split("|")[0]);
                iOffLft = Number(elPop.dataset.popoverPos.split("|")[1]);
                elPop.dataset.popover = "true"; // Open and Active
                elPop.style.left = oPopOver.position().left+"px";
                elPop.style.top = oPopOver.position().top+"px";
            },
            "closeAll": function(){ // Close all Popovers
                if( arPops.length == 0) return false;
                arPops.map(function(el){
                    el.dataset.popover = "false";
                });
            },
            "position": function(){ // Determine Popover position
                let rec = ePos.getBoundingClientRect(),
                pxLft = _win.pageXOffset || _doc.documentElement.scrollLeft,
                pxTop = _win.pageYOffset || _doc.documentElement.scrollTop;
                return { top: (rec.top + pxTop + iOffTop), left: (rec.left + pxLft + iOffLft) }
            }
        }
    })(window, _doc, "[data-popover]"); // Declarative implementation
{{< /highlight >}}
<span class="h-ds__none"
data-at="Vanilla JS Popover|Declarative implementation|Floating UI Widget|Popover Microinteraction|Declarative Binding"></span>
</output>