---
title: "JS Airport Geo-Proximity Radius"
date: 2020-12-07T20:26:54-06:00
draft: false
summary: "Airport geo-proximity logic that answers questions, like; “What are the three closest airports to me right now?”
slug: javascript
categories:
- NGS
- GEOLOCATION
tags:
- API
- JavaScript
---
<output>
{{< highlight JavaScript >}}
// Desc: Get the closest airports by geolocation radius
// Usage: closestAirports.find(-99, -99, oAirports, 4); // 4 miles

function getDistance(lat1, lon1, lat2, lon2) {
    var radlat1 = Math.PI * lat1/180;
    var radlat2 = Math.PI * lat2/180;
    var theta = lon1-lon2;
    var radtheta = Math.PI * theta/180;
    var dst = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
    if (dst > 1) dst = 1;
    dst = Math.acos(dst);
    dst = dst * 180/Math.PI;
    dst = dst * 60 * 1.1515; // miles
    return dst;
  }

closestAirports = (function(_d){
    return {
      "find": function(nLat, nLon, objPorts, nRadius){
        if(nLat && nLon && objPorts){
          var arrPorts = [];
          for (var prop in objPorts) { // Sort Object
            if (objPorts.hasOwnProperty(prop)) {
              var lat = objPorts[prop].geoCode.split(",")[0];
              var lon = objPorts[prop].geoCode.split(",")[1];
              arrPorts.push({
                'key': prop, 'lat': lat, 'lon': lon,
                "dist": getDistance(lat, lon, nLat, nLon),
                "formattedAirport": objPorts[prop].formattedAirport
              });
            }
          }
          arrPorts.sort(function(a, b){
            return a.dist - b.dist;
          });
          return arrPorts.filter(function(aP){
            return (aP.dist <= nRadius);
          });
        }
      }
    };
})(document);
{{< /highlight >}}
<span class="h-ds__none"
data-at="Airports within X Miles|Longitude & Latitude|Geo-Proximity Radius|Closest X number of Airports"></span>
</output>
